from ImageData import ImageData
import PIL.Image as Img # pip install pillow
import io
import tempfile

class Image:
    def __init__(self):
        self.content_type = ""
        self.image = ImageData()
        self.temp = tempfile.NamedTemporaryFile()

    def clear(self):
        self.content_type = ""
        if self.image != None: self.image.clear()

    def update_fields(self, dictionary):
        self.content_type = dictionary['content_type']
        self.image.update_data(dictionary['image'])

    def render(self):
        byte_string = bytearray(self.image.userData)
        self.rendered_image = Img.open(io.BytesIO(byte_string))
        self.image_path = f'{self.temp.name}.png'
        self.rendered_image.save(self.image_path)


# Testing
if __name__ == '__main__':
    img = Image()
    img.update_fields({'content_type': 'image/png', 'image': [137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 128, 0, 0, 0, 128, 8, 2, 0, 0, 0, 76, 92, 246, 156, 0, 0, 0, 1, 115, 82, 71, 66, 0, 174, 206, 28, 233, 0, 0, 0, 4, 103, 65, 77, 65, 0, 0, 177, 143, 11, 252, 97, 5, 0, 0, 0, 9, 112, 72, 89, 115, 0, 0, 14, 195, 0, 0, 14, 195, 1, 199, 111, 168, 100, 0, 0, 3, 80, 73, 68, 65, 84, 120, 94, 237, 210, 91, 114, 219, 64, 12, 68, 81, 239, 127, 211, 10, 45, 222, 137, 49, 124, 88, 81, 153, 64, 131, 78, 159, 31, 167, 6, 35, 162, 201, 206, 199, 195, 164, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 152, 11, 16, 115, 1, 98, 55, 43, 224, 227, 91, 92, 186, 149, 27, 132, 230, 235, 190, 137, 31, 183, 215, 52, 40, 95, 241, 34, 60, 180, 165, 118, 225, 248, 102, 9, 88, 208, 76, 175, 88, 124, 170, 52, 172, 233, 164, 75, 38, 190, 208, 43, 220, 62, 193, 165, 87, 184, 221, 67, 139, 52, 124, 152, 115, 220, 123, 7, 191, 60, 199, 61, 53, 113, 14, 62, 198, 9, 46, 253, 0, 15, 58, 193, 37, 41, 101, 8, 62, 195, 17, 110, 92, 132, 135, 30, 225, 134, 142, 44, 1, 31, 96, 135, 113, 2, 22, 236, 48, 22, 209, 172, 231, 213, 119, 24, 103, 98, 211, 236, 236, 252, 66, 235, 246, 61, 65, 1, 36, 154, 49, 43, 193, 202, 114, 172, 159, 85, 23, 64, 150, 25, 179, 66, 44, 174, 197, 238, 153, 190, 0, 6, 229, 88, 95, 136, 197, 179, 210, 247, 39, 72, 192, 64, 132, 16, 37, 88, 185, 83, 247, 9, 8, 18, 48, 144, 34, 74, 192, 160, 202, 255, 94, 192, 130, 52, 1, 131, 18, 69, 203, 120, 179, 128, 65, 3, 4, 26, 56, 173, 82, 177, 143, 55, 11, 24, 180, 65, 172, 39, 142, 170, 184, 128, 79, 196, 122, 226, 168, 74, 250, 62, 94, 43, 96, 208, 12, 225, 92, 128, 10, 225, 126, 125, 1, 156, 182, 68, 196, 103, 72, 254, 149, 102, 221, 184, 112, 1, 95, 136, 88, 133, 165, 235, 159, 36, 172, 10, 24, 116, 69, 202, 18, 108, 92, 255, 36, 97, 213, 192, 105, 99, 4, 45, 193, 198, 245, 79, 18, 86, 13, 156, 54, 70, 208, 124, 236, 115, 1, 27, 4, 13, 24, 164, 73, 92, 192, 27, 12, 156, 182, 71, 220, 128, 65, 14, 23, 176, 69, 220, 128, 65, 14, 23, 112, 128, 196, 1, 131, 4, 46, 224, 0, 137, 3, 6, 9, 92, 192, 49, 66, 7, 12, 174, 230, 2, 182, 136, 59, 112, 154, 198, 5, 108, 17, 119, 224, 52, 141, 11, 216, 34, 238, 192, 105, 26, 23, 176, 69, 220, 129, 211, 52, 46, 96, 139, 184, 3, 167, 105, 114, 23, 240, 18, 3, 167, 141, 17, 116, 224, 52, 147, 11, 152, 16, 116, 224, 52, 147, 11, 152, 16, 116, 224, 52, 211, 193, 14, 150, 39, 96, 65, 99, 4, 29, 56, 205, 180, 221, 193, 230, 52, 172, 105, 137, 136, 1, 131, 76, 46, 224, 11, 17, 7, 78, 147, 85, 23, 176, 96, 83, 51, 132, 11, 24, 36, 59, 88, 195, 254, 52, 172, 105, 134, 112, 1, 131, 100, 21, 107, 120, 161, 128, 65, 27, 196, 10, 24, 228, 115, 1, 159, 136, 21, 48, 200, 87, 180, 137, 215, 10, 24, 52, 64, 160, 128, 65, 137, 194, 170, 103, 156, 54, 64, 160, 128, 65, 9, 89, 1, 11, 6, 82, 68, 9, 24, 84, 57, 216, 71, 144, 18, 172, 20, 33, 68, 192, 160, 208, 118, 37, 65, 10, 177, 184, 28, 235, 103, 204, 10, 233, 11, 88, 176, 187, 16, 139, 103, 204, 106, 181, 40, 96, 193, 250, 18, 172, 156, 49, 43, 119, 176, 152, 68, 229, 88, 159, 140, 101, 51, 102, 10, 186, 230, 79, 48, 78, 192, 130, 29, 198, 34, 210, 242, 207, 113, 227, 34, 60, 244, 8, 55, 116, 212, 253, 127, 139, 75, 63, 192, 131, 78, 112, 73, 170, 193, 127, 129, 87, 184, 247, 38, 126, 124, 142, 123, 106, 109, 114, 252, 27, 110, 159, 224, 210, 43, 220, 238, 161, 81, 26, 62, 79, 50, 150, 181, 209, 47, 80, 26, 22, 52, 211, 53, 214, 165, 120, 104, 75, 173, 195, 173, 248, 138, 239, 227, 247, 189, 221, 35, 229, 95, 124, 218, 19, 92, 186, 149, 91, 134, 254, 77, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 152, 11, 16, 115, 1, 98, 46, 64, 204, 5, 136, 185, 0, 49, 23, 32, 230, 2, 196, 92, 128, 212, 227, 241, 7, 98, 1, 14, 114, 245, 150, 203, 56, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130]})
    img.render()
    print(img.image_path)